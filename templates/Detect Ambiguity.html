<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/typed.js/2.0.11/typed.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/waypoints/4.0.1/jquery.waypoints.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js"></script>
    <link rel="icon" href="./images/Portfolio_icon.jpeg" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"/>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style2.css') }}">
    <title>Detect Ambiguity</title>
</head>
<body>
    <nav class="navbar">
        <div class="max-width">
            <div class="logo"><a href="{{ url_for('index') }}">Anaphoric <span>Ambiguity Detector</span></a></div>
        </div>
    </nav>
    <section class="home" id="home">
        <div class="max-width">
            <div class="home-content">
                <div class="text-1">Detect Ambiguity</div>
                <form id="uploadForm" enctype="multipart/form-data">
                    <input type="file" id="fileInput" style="display: none;" onchange="handleFileUpload()">
                    <label for="fileInput" id="chooseFileLabel" class="start-button">Choose File</label>
                    <div id="selectedFile"></div>
                    <button type="button" id="uploadButtonOutside" class="start-button" style="display: none;" onclick="uploadFile()">Upload File</button>
                </form>
                <div id="results"></div>
            </div>
        </div>
    </section>
    <script src="{{ url_for('static', filename='js/style.js') }}"></script>
    <script>
    document.addEventListener('DOMContentLoaded', function () {
    var fileInput = document.getElementById('fileInput');
    var uploadButtonOutside = document.getElementById('uploadButtonOutside');
    var selectedFile = document.getElementById('selectedFile');
    var chooseFileLabel = document.getElementById('chooseFileLabel');

    fileInput.addEventListener('change', handleFileUpload);

    function handleFileUpload() {
        var file = fileInput.files[0];

        if (file) {
            selectedFile.innerHTML = 'Selected File: ' + file.name;
            uploadButtonOutside.style.display = 'block';
            chooseFileLabel.style.display = 'none';
        } else {
            selectedFile.innerHTML = '';
            uploadButtonOutside.style.display = 'none';
            chooseFileLabel.style.display = 'block';
        }
    }

    function uploadFile() {
        var file = fileInput.files[0];

        if (file) {
            var formData = new FormData();
            formData.append('file', file);

            selectedFile.innerHTML = 'Uploading...';

            fetch('/detect_ambiguity', {
                method: 'POST',
                body: formData
            })
           .then(response => {
                const contentType = response.headers.get("content-type");
                if (contentType && contentType.indexOf("application/json")!== -1) {
                    return response.json();
                } else {
                    return response.text().then(text => { throw new Error(text); });
                }
            })
           .then(data => {
                if (Array.isArray(data)) {
                    displayPredictionResults(data);
                } else if (data.error) {
                    selectedFile.innerHTML = 'Error: ' + data.error;
                } else {
                    selectedFile.innerHTML = 'Unexpected response format';
                }
            })
           .catch(error => {
                selectedFile.innerHTML = 'Error: ' + error.message;
                console.error('Error:', error);
            });
        } else {
            selectedFile.innerHTML = 'No file selected';
        }
    }

    function displayPredictionResults(data) {
        var resultsDiv = document.getElementById('results');
        var predictionHtml = '<h2>Prediction Results</h2>';
        predictionHtml += '<table>';
        predictionHtml += '<tr><th>Sentence</th><th>Predicted Ambiguity</th></tr>';

        data.forEach(item => {
            predictionHtml += '<tr>';
            predictionHtml += `<td>${item.Sentence}</td>`;
            predictionHtml += `<td>${item['Predicted Ambiguity']}</td>`;
            predictionHtml += '</tr>';
        });

        predictionHtml += '</table>';
        resultsDiv.innerHTML = predictionHtml;
    }
});
</script>
</body>
</html>